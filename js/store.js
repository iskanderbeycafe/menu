const menu = {
    mainDishes: [
        {
            img: "Adana veya urfa kebap",
            name: {
                ru: "Адана или кебаб Урфа",
                tr: "Adana veya urfa kebap",
                en: "Adana or urfa kebap"
            },

            price: {
                "1": 250,
                "1.5": 375,
            },
        },
        {
            img: "Kuzu Şiş",
            name: {
                ru: "Бараньи шашлыки",
                tr: "Kuzu Şiş",
                en: "Lamb Shish"
            },

            price: {
                "1": 350,
                "1.5": 525,
            },
        },
        {
            img: "Tavuk Şiş",
            name: {
                ru: "Куриный шашлык",
                tr: "Tavuk Şiş",
                en: "Chiken Shish"
            },

            price: {
                "1": 240,
                "1.5": 360,
            },
        },
        {
            img: "Izgara kofte",
            name: {
                ru: "Мясные шарики на гриле",
                tr: "Izgara kofte",
                en: "Grilled meatball"
            },
            price: {
                "1": 250,
                "1.5": 375,
            },
        },
        {
            img: "Patlicanli kebap",
            name: {
                ru: "Шашлык из баклажанов",
                tr: "Patlicanli kebap",
                en: "kebab with eggplant"
            },

            price: {
                "1": 300,
                "1.5": 450,
            },
        },
        {
            img: "İskender köfte",
            name: {
                ru: "Искендер кофте",
                tr: "İskender köfte",
                en: "Iskender meatball"
            },
            price: {
                "150": 250,
                "200": 375,
            },
        },
        {
            img: "Karışık Izgara Et",
            name: {
                ru: "Смешанное мясо на гриле",
                tr: "Karışık Izgara Et",
                en: "Mixedilled Meat"
            },
            description: {
                ru: "",
                tr: "tek",
                en: "Single"
            },
            price: {
                "1": 1050,
                "2": 2100,
            },
        },
        {
            img: "Ciğer",
            name: {
                ru: "Печень",
                tr: "Ciğer",
                en: "Liver"
            },
            price: {
                "1": 280,
                "1.5": 420,
            },
        },
        {
            img: "Sade et doner",
            name: {
                ru: "Мясной донер",
                tr: "Sade et doner",
                en: "Plainmeat doner"
            },
            price: {
                "100": 250,
                "150": 375,
                "200": 500,
            },
        },
        {
            img: "Pilav ustu et doner",
            name: {
                ru: "Донер с мясом и рисом",
                tr: "Pilav ustu et doner",
                en: "Meat doner with rice"
            },
            price: {
                "100": 250,
                "150": 375,
                "200": 500,
            },
        },
        {
            img: "Pilav ustu tavuk doner",
            name: {
                ru: "Куриный донер",
                tr: "Pilav ustu tavuk doner",
                en: "Chicken doner with rice"
            },

            price: {
                "100": 190,
                "150": 285,
                "200": 380,
            },
        },
        {
            img: "Sade tavuk doner",
            name: {
                ru: "Куриный донер",
                tr: "Sade tavuk doner",
                en: "Plain chicken doner"
            },
            price: {
                "100": 190,
                "150": 285,
                "200": 380,
            },
        },
        {
            img: "Kuzu pirzola",
            name: {
                ru: "Бараньи отбивные",
                tr: "Kuzu pirzola",
                en: "Lamb chops"
            },
            price: {
                "1": 460,
                "1.5": 690,
            },
        },
    ],

    pide: [

        {
            img: "2",
            name: {
                ru: "пиде",
                tr: "pide",
                en: "pide"
            },
            description: {
                ru: "Одна порция",
                tr: "Porsiyon",
                en: "Portion"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "3",
            name: {
                ru: "пиде",
                tr: "pide",
                en: "pide"
            },
            description: {
                ru: "Одна порция",
                tr: "Porsiyon",
                en: "Portion"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "Kasarli pide",
            name: {
                ru: "Сырный лаваш",
                tr: "Kasarli pide",
                en: "Pita with kashar cheese"
            },

            price: {
                "1": 180,
                "1.5": 270,
            },
        },
        {
            img: "5",
            name: {
                ru: "лаваш",
                tr: "pide",
                en: "Pita"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "7",
            name: {
                ru: "лаваш",
                tr: "pide",
                en: "Pita"
            },
            description: {
                ru: "Одна порция",
                tr: "Porsiyon",
                en: "Portion"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "Kiymali kasarli pide",
            name: {
                ru: "лаваш",
                tr: "Kiymali kasarli pide",
                en: "Pita with kashar cheese andound meat"
            },
            price: {
                "1": 210,
                "1.5": 305,
            },
        },
        {
            img: "Lahmacun",
            name: {
                ru: "Лахмаджун",
                tr: "Lahmacun",
                en: "Lahmacun"
            },
            price: {
                "2": 190,
            },
        },
    ],
    hamburgers: [
        {
            img: "Cizburger",
            name: {
                ru: "Чизбургер",
                tr: "Cizburger",
                en: "Cheeseburger"
            },
            price: {
                "1": 220,
            },
        },
        {
            img: "Et döner burger",
            name: {
                ru: "Мясной донер бургер",
                tr: "Et döner burger",
                en: "Meat doner burger"
            },
            price: {
                "1": 240,
            },
        },
        {
            img: "Hamburger",
            name: {
                ru: "Гамбургер",
                tr: "Hamburger",
                en: "Hamburger"
            },
            price: {
                "1": 185,
            },
        },
        {
            img: "Tavuk döner Burger",
            name: {
                ru: "Куриный донер бургер",
                tr: "Tavuk döner Burger",
                en: "Chicken doner Burger"
            },
            price: {
                "1": 185,
            },
        },
    ],
    kiramika: [
        {
            img: "Kaşarlı mantar güveç",
            name: {
                ru: "Грибная запеканка с чеддером",
                tr: "Kaşarlı mantar güveç",
                en: "Mushroom casserole with cheddar"
            },
            price: {
                "1": 210,
                "1.5": 305,
            },
        },
        {
            img: "Kofte güveç",
            name: {
                ru: "Запеканка с фрикадельками",
                tr: "Kofte güveç",
                en: "Meatball stew"
            },
            price: {
                "1": 270,
                "1.5": 405,
            },
        },
        {
            img: "Tavuk güveç",
            name: {
                ru: "куриная запеканка",
                tr: "Tavuk güveç",
                en: "Chicken stew"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "Et güveç",
            name: {
                ru: "Мясное рагу",
                tr: "Et güveç",
                en: "Meat stew"
            },
            price: {
                "1": 380,
                "1.5": 570,
            },
        }
    ],
    pizza: [
        {
            img: "Karisik pizza",
            name: {
                ru: "Смешанная пицца",
                tr: "Karisik pizza",
                en: "Mexed pizza"
            },
            price: {
                "1": 190,
            },
        },
        {
            img: "Sebzell pizza",
            name: {
                ru: "Овощная пицца",
                tr: "Sebzell pizza",
                en: "Vegetable pizza"
            },
            price: {
                "1": 190,
            },
        },
        {
            img: "3",
            name: { ru: "пицца", tr: "pizza", en: "pizza" },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
    ],
    snacks: [
        {
            img: "Kapali doner",
            name: {
                ru: "Закрытый донер с мясом",
                tr: "Etli kapalı döner ",
                en: "Closed doner with meat"
            },

            price: {
                "1": 280,
                "1.5": 420,
            },
        },
        {
            img: "Kapali doner",
            name: {
                ru: "Закрытый донер с курицей",
                tr: "Tavuklu kapalı döner",
                en: "Closed doner with chicken"
            },
            price: {
                "1": 260,
                "1.5": 390,
            },
        },
        {
            img: "1",
            name: {
                ru: "Сырная тарелка",
                tr: "Peynir Tabağı",
                en: "Cheese Platter"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "Et iskander",
            name: {
                ru: "мясной искандер",
                tr: "Et iskander",
                en: "Meat iskander"
            },
            price: {
                "150": 250,
                "200": 375,
            },
        },
        {
            img: "Tavuk iskander",
            name: {
                ru: "Куриный искандер",
                tr: "Tavuk iskander",
                en: "Chicken iskander"
            },
            price: {
                "100": 210,
                "150": 315,
                "200": 420,
            },
        },
        {
            img: "Beyti sarma",
            name: {
                ru: "Кебаб-бейти",
                tr: "Beyti sarma",
                en: "Beyti wrap"
            },
            price: {
                "1": 280,
                "1.5": 420,
            },
        },
        {
            img: "Et gobit",
            name: {
                ru: "мясной гоббит",
                tr: "Et gobit",
                en: "Meat gobit"
            },
            price: {
                "100": 210,
                "150": 315,
                "200": 420,
            },
        },
        {
            img: "Tavuk gobit",
            name: {
                ru: "Куриный гоббит",
                tr: "Tavuk gobit",
                en: "Chicken gobit"
            },
            price: {
                "100": 100,
                "150": 150,
                "200": 200,
            },
        },
        {
            img: "Et durum",
            name: {
                ru: "Мясной ",
                tr: "Et durum",
                en: "Meat wrap"
            },
            price: {
                "100": 210,
                "150": 315,
                "200": 350,
            },
        },
        {
            img: "Tavuk dürüm",
            name: {
                ru: "Сырная тарелка",
                tr: "Tavuk dürüm",
                en: "Chicken wrap"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        }
    ],
    dessert: [
        {
            img: "1",
            name: { ru: "Говяжьи ребрышки", tr: "Dana Kaburga", en: "Beef Ribs" },
            description: {
                ru: "Говяжьи ребрышки, приготовленные в специальном барбекю на яблоневом дереве, коптятся на медленном огне 10-12...",
                tr: "Özel BBQ’de, elma odunuyla, 10-12 saate kadar ağır ateşte tütsülenerek pişirilmiş dana kaburga, baharatlı baby patates...",
                en: "Beef ribs cooked in a special BBQ with apple wood, smoked over a slow fire for 10-12 hours, spicy baby potatoes..."
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
    ],
    drinks: [
        {
            img: "1",
            name: { ru: "Аффогато", tr: "Affogato", en: "Beef Ribs" },
            description: {
                ru: "С ванильным мороженым и эспрессо",
                tr: "Vanilyalı dondurma ve Espresso ile",
                en: "With vanilla ice cream and espresso"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "2",
            name: { ru: "Капучино", tr: "Cappuccino", en: "Cappuccino" },
            description: {
                ru: "С эспрессо и молочным кремом",
                tr: "Espresso ve süt kreması ile",
                en: "With espresso and milk cream"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "3",
            name: { ru: "Классический турецкий чай", tr: "Klasik Türk Çayı", en: "Classic Turkish Tea" },
            description: {
                ru: "Описание товара отсутствует",
                tr: "Ürün açıklaması bulunmamaktadır",
                en: "There is no product description"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "4",
            name: { ru: "Бутылка Coca Cola", tr: "Coca Cola Şişe", en: "Coca Cola Bottle" },
            description: {
                ru: "Описание товара отсутствует",
                tr: "Ürün açıklaması bulunmamaktadır",
                en: "There is no product description"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        },
        {
            img: "5",
            name: { ru: "Бутылка Sprite", tr: "Sprite Şişe", en: "Sprite Bottle" },
            description: {
                ru: "Описание товара отсутствует",
                tr: "Ürün açıklaması bulunmamaktadır",
                en: "There is no product description"
            },
            price: {
                "1": 250,
                "1.5": 300,
                "2": 350,
            },
        }
    ]
}


//конец базы даных 



const lang = document.querySelector("html").getAttribute("lang");


const menuListAll = document.querySelectorAll(".menu-list"); // Дивы с категориями для карточек
for (let i = 0; i < menuListAll.length; i++) { // Цикл, который подставляет все карточки с блюдами
    const menuListDiv = menuListAll[i];
    const menuListDivID = menuListDiv.getAttribute("id");
    for (let j = 0; j < menu[menuListDivID].length; j++) {
        const cartInfo = menu[menuListDivID][j];
        let cartDiv = document.createElement("div");
        cartDiv.className = "menu-cart";

        // Создание элементов для цен и количества
        let priceElements = '';
        console.log(cartInfo)
        for (let priceKey of Object.keys(cartInfo.price).sort((a, b) => parseFloat(a) - parseFloat(b))) {
            priceElements += `
            <div class="menu-cart__price-amount" data-dish-name="${cartInfo.name[lang]}" data-dish-name-tr="${cartInfo.name.tr}" data-portion="${priceKey}" data-price="${cartInfo.price[priceKey]}">
                <span class="price__value">${priceKey} порция: ${cartInfo.price[priceKey]}₺</span>
                <div class="menu-cart__amount">
                    <button class="amount-decrease"> - </button>
                    <span class="amount-number">0</span>
                    <button class="amount-increase"> + </button>
                </div>
            </div>`;
        }

        cartDiv.innerHTML = `
            <i class="fa-solid fa-circle-check"></i>
            <img src="./img/menu/${menuListDivID}/${cartInfo.img}.jpg" alt="">
            <div class="menu-cart__info">
                <div>
                    <h3>${cartInfo.name[lang]}</h3>
                </div>
                <div class="menu-cart__details">
                ${priceElements}
                </div>
            </div>
        `;
        menuListDiv.appendChild(cartDiv);
    }
}

let selectedItems = []; // Массив для хранения выбранных блюд
// Функция для обновления выбранных блюд
function updateSelectedItems(dishName, dishNameTr, portion, amount, price) {
    const existingItem = selectedItems.find(item => item.dishName === dishName && item.portion === portion);
    if (existingItem) {
        existingItem.amount = amount;
        existingItem.totalPrice = amount * price;
        if (amount === 0) {
            const index = selectedItems.indexOf(existingItem);
            selectedItems.splice(index, 1);
        }
    } else {
        selectedItems.push({
            dishName: dishName,
            dishNameTr: dishNameTr,
            portion: portion,
            amount: amount,
            totalPrice: amount * price
        });
    }
    console.log(selectedItems); // Выводим в консоль для проверки
    updateBasket();
    updateMenuCards();
    saveToLocalStorage(selectedItems); // Сохраняем данные в локальное хранилище
}

// Функция для сохранения данных в локальное хранилище
function saveToLocalStorage(data) {
    localStorage.setItem("selectedItems", JSON.stringify(data));
}
// Функция для загрузки данных из локального хранилища
function loadFromLocalStorage() {
    const data = localStorage.getItem("selectedItems");
    if (data) {
        return JSON.parse(data);
    }
    return [];
} 

// Загрузка данных из локального хранилища при загрузке страницы
selectedItems = loadFromLocalStorage();

// Добавление обработчика события для окончания загрузки страницы
window.addEventListener("load", function () {
    updateBasket();
    updateMenuCards();
});

// Функция для обновления корзины
function updateBasket() {
    const basketDiv = document.querySelector(".basket__list");
    basketDiv.innerHTML = ''; // Очистка корзины

    let totalPrice = 0; // Инициализация общей стоимости

    selectedItems.forEach(item => {
        let basketItemDiv = document.createElement("div");
        basketItemDiv.className = "basket-item";
        basketItemDiv.setAttribute("data-dish-name", item.dishName);
        basketItemDiv.setAttribute("data-portion", item.portion);

        basketItemDiv.innerHTML = `
            <div class="basket-item__info">
                <h4>${item.dishName}</h4>
                <h4>(${item.dishNameTr})</h4>
            </div>
            <div class="basket-item__amount">
                <button class="basket-amount-decrease"> - </button>
                <span class="basket-amount-number">${item.amount}</span>
                <button class="basket-amount-increase"> + </button>
            </div>
            <div class="basket-item__price">
                <p>${item.portion} порция</p>
                <p>${item.totalPrice} TL</p>
            </div>

        `;

        basketDiv.appendChild(basketItemDiv);
        totalPrice += item.totalPrice; // Обновление общей стоимости
    });

    // Обновление итоговой стоимости в спане
    const totalNumberSpan = document.querySelector("#basketAll");
    totalNumberSpan.textContent = totalPrice;
    basketShowHide();
}

// Функция для обновления карточек меню
function updateMenuCards() {
    const menuCards = document.querySelectorAll(".menu-cart__price-amount");
    menuCards.forEach(card => {
        const dishName = card.getAttribute("data-dish-name");
        const dishNameTr = card.getAttribute("data-dish-name-tr");
        const portion = card.getAttribute("data-portion");
        const amountElement = card.querySelector(".amount-number");
        const selectedItem = selectedItems.find(item => item.dishName === dishName && item.portion === portion);
        if (selectedItem) {
            amountElement.textContent = selectedItem.amount;
        } else {
            amountElement.textContent = "0";
        }
    });
}

// Добавление обработчиков событий для кнопок
document.addEventListener("click", function (event) {
    if (event.target.classList.contains("amount-increase")) {
        const amountNumber = event.target.previousElementSibling;
        const newAmount = parseInt(amountNumber.textContent) + 1;
        amountNumber.textContent = newAmount;

        const priceAmountDiv = event.target.closest(".menu-cart__price-amount");
        const dishName = priceAmountDiv.getAttribute("data-dish-name");
        const dishNameTr = priceAmountDiv.getAttribute("data-dish-name-tr");
        const portion = priceAmountDiv.getAttribute("data-portion");
        const price = parseInt(priceAmountDiv.getAttribute("data-price"));

        updateSelectedItems(dishName, dishNameTr, portion, newAmount, price);
    } else if (event.target.classList.contains("amount-decrease")) {
        const amountNumber = event.target.nextElementSibling;
        const newAmount = parseInt(amountNumber.textContent) > 0 ? parseInt(amountNumber.textContent) - 1 : 0;
        amountNumber.textContent = newAmount;

        const priceAmountDiv = event.target.closest(".menu-cart__price-amount");
        const dishName = priceAmountDiv.getAttribute("data-dish-name");
        const dishNameTr = priceAmountDiv.getAttribute("data-dish-name-tr");
        const portion = priceAmountDiv.getAttribute("data-portion");
        const price = parseInt(priceAmountDiv.getAttribute("data-price"));

        updateSelectedItems(dishName, dishNameTr, portion, newAmount, price);
    } else if (event.target.classList.contains("basket-amount-increase")) {
        const amountNumber = event.target.previousElementSibling;
        const newAmount = parseInt(amountNumber.textContent) + 1;
        amountNumber.textContent = newAmount;

        const basketItemDiv = event.target.closest(".basket-item");
        const dishName = basketItemDiv.getAttribute("data-dish-name");
        const portion = basketItemDiv.getAttribute("data-portion");
        const item = selectedItems.find(item => item.dishName === dishName && item.portion === portion);

        updateSelectedItems(dishName, item.dishNameTr, portion, newAmount, item.totalPrice / item.amount);
    } else if (event.target.classList.contains("basket-amount-decrease")) {
        const amountNumber = event.target.nextElementSibling;
        const newAmount = parseInt(amountNumber.textContent) > 0 ? parseInt(amountNumber.textContent) - 1 : 0;
        amountNumber.textContent = newAmount;

        const basketItemDiv = event.target.closest(".basket-item");
        const dishName = basketItemDiv.getAttribute("data-dish-name");
        const portion = basketItemDiv.getAttribute("data-portion");
        const item = selectedItems.find(item => item.dishName === dishName && item.portion === portion);

        updateSelectedItems(dishName, item.dishNameTr, portion, newAmount, item.totalPrice / item.amount);
    }
});


const basketDiv = document.querySelector(".basket");//див в которым отображается карзина 



const basketList = document.querySelector(".basket__list");//див в кором отображаются выброные блюда
function basketShowHide() {//фуекцыя включения или отключения корзины
    if (selectedItems.length == 0) {// если корзина пустая то мы ее прячем
        basketDiv.classList.remove("basket_active");
    } else {//если карина не пустая 
        basketDiv.classList.add("basket_active");
    }
}



const basketButton = document.querySelector(".basket__buttonOpen");
basketButton.onclick = function () {
    basketButton.classList.toggle("basket__button_active");
    basketDiv.classList.toggle("basket_active_full");
}

// // Получаем данные из локального хранилища
// const dataToPass = localStorage.getItem("selectedItems");

// // Кодируем данные в URL-параметр и переходим на page2.html
// if (dataToPass) {
//     const encodedData = encodeURIComponent(dataToPass);
//     window.location.href = `reviewsRU.html?data=${encodedData}`;
// } else {
//     alert("Данные в локальном хранилище отсутствуют.");
// }